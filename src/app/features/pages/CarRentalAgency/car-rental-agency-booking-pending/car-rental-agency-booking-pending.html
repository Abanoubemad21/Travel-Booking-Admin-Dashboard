<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pending Car Rental Bookings</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<!-- car-rental-agency-booking-pending.html -->
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h3 mb-0 text-gray-800">
      <i class="fas fa-clock me-2 text-warning"></i>
      Pending Car Rentals
    </h2>
    <div class="d-flex gap-2">
      <button 
        class="btn btn-success" 
        (click)="bulkConfirmBookings()" 
        [disabled]="loading || stats.urgentBookings === 0">
        <i class="fas fa-check-double me-1"></i>
        Confirm All Urgent ({{ stats.urgentBookings }})
      </button>
      <button class="btn btn-outline-primary" (click)="loadPendingBookings()" [disabled]="loading">
        <i class="fas fa-sync-alt me-1" [class.fa-spin]="loading"></i>
        Refresh
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-warning shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                Total Pending
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.totalPending }}
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-clock fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-danger shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                Urgent Bookings
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.urgentBookings }}
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                Potential Revenue
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ formatCurrency(stats.potentialRevenue) }}
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                Avg. Wait Time
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                {{ stats.averageWaitTime | number:'1.0-1' }}h
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-hourglass-half fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Priority Alert -->
  <div *ngIf="stats.urgentBookings > 0" class="alert alert-warning d-flex align-items-center mb-4" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <div>
      <strong>Attention!</strong> You have {{ stats.urgentBookings }} urgent booking(s) that need immediate attention.
      <button class="btn btn-sm btn-warning ms-2" (click)="priorityFilter = 'high'; onFilterChange()">
        View Urgent
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
        <i class="fas fa-filter me-2"></i>
        Filter & Sort Pending Bookings
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-2 mb-3">
          <label for="priorityFilter" class="form-label">Priority</label>
          <select 
            id="priorityFilter"
            class="form-select" 
            [(ngModel)]="priorityFilter" 
            (change)="onFilterChange()">
            <option value="all">All Priorities</option>
            <option value="high">Urgent (24h)</option>
            <option value="medium">Medium (72h)</option>
            <option value="low">Low (&gt;72h)</option>
          </select>
        </div>

        <div class="col-md-3 mb-3">
          <label for="searchTerm" class="form-label">Search</label>
          <input 
            type="text" 
            id="searchTerm"
            class="form-control" 
            placeholder="Email or Car Model"
            [(ngModel)]="searchTerm" 
            (input)="onFilterChange()">
        </div>
        
        <div class="col-md-2 mb-3">
          <label for="dateFilter" class="form-label">Start Date</label>
          <input 
            type="date" 
            id="dateFilter"
            class="form-control" 
            [(ngModel)]="dateFilter" 
            (change)="onFilterChange()">
        </div>
        
        <div class="col-md-3 mb-3">
          <label for="sortBy" class="form-label">Sort By</label>
          <select 
            id="sortBy"
            class="form-select" 
            [(ngModel)]="sortBy" 
            (change)="onFilterChange()">
            <option value="priority">Priority</option>
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="highest-value">Highest Value</option>
            <option value="lowest-value">Lowest Value</option>
          </select>
        </div>
        
        <div class="col-md-2 mb-3 d-flex align-items-end">
          <button 
            class="btn btn-outline-secondary w-100" 
            (click)="clearFilters()">
            <i class="fas fa-times me-1"></i>
            Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="d-flex justify-content-center py-5">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
    <button class="btn btn-outline-danger btn-sm ms-3" (click)="loadPendingBookings()">
      <i class="fas fa-redo me-1"></i>
      Retry
    </button>
  </div>

  <!-- Pending Bookings List -->
  <div *ngIf="!loading && !error" class="card shadow mb-4">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
      <h6 class="m-0 font-weight-bold text-primary">
        <i class="fas fa-list me-2"></i>
        Pending Bookings ({{ filteredBookings.length }})
      </h6>
      <span class="badge bg-warning fs-6">{{ formatCurrency(stats.potentialRevenue) }} Potential Revenue</span>
    </div>
    <div class="card-body">
      <!-- No bookings message -->
      <div *ngIf="filteredBookings.length === 0" class="text-center py-5">
        <i class="fas fa-clock fa-3x text-gray-300 mb-3"></i>
        <h5 class="text-gray-600">No pending bookings found</h5>
        <p class="text-gray-500">
          <span *ngIf="pendingBookings.length === 0">You don't have any pending bookings at the moment.</span>
          <span *ngIf="pendingBookings.length > 0">Try adjusting your filters to see more results.</span>
        </p>
      </div>

      <!-- Bookings grid with priority-based layout -->
      <div *ngIf="filteredBookings.length > 0" class="row">
        <div *ngFor="let booking of filteredBookings; trackBy: trackByBookingId; let i = index" 
             class="col-lg-6 col-xl-4 mb-4">
          <div class="card h-100" 
               [class.border-danger]="getBookingPriority(booking) === 'high'"
               [class.border-warning]="getBookingPriority(booking) === 'medium'"
               [class.border-info]="getBookingPriority(booking) === 'low'">
            <div class="card-header py-2" 
                 [class.bg-danger]="getBookingPriority(booking) === 'high'"
                 [class.bg-warning]="getBookingPriority(booking) === 'medium'"
                 [class.bg-info]="getBookingPriority(booking) === 'low'"
                 [class.text-white]="getBookingPriority(booking) !== 'low'">
              <div class="d-flex justify-content-between align-items-center">
                <span class="badge" 
                      [class.bg-light]="getBookingPriority(booking) !== 'low'"
                      [class.text-dark]="getBookingPriority(booking) !== 'low'"
                      [class.bg-primary]="getBookingPriority(booking) === 'low'">
                  #{{ booking.id }}
                </span>
                <span [class]="getPriorityBadgeClass(getBookingPriority(booking))">
                  {{ getPriorityLabel(getBookingPriority(booking)) }}
                </span>
              </div>
            </div>
            <div class="card-body">
              <!-- Customer Info -->
              <div class="mb-3">
                <h6 class="card-title mb-1">
                  <i class="fas fa-user me-1 text-primary"></i>
                  {{ booking.customerEmail }}
                </h6>
              </div>

              <!-- Car Details -->
              <div class="mb-3">
                <h6 class="text-primary">
                  <i class="fas fa-car me-1"></i>
                  {{ booking.agencyDetails?.model || 'N/A' }}
                </h6>
                <div class="small text-muted">
                  <div class="mb-1">
                    <i class="fas fa-map-marker-alt me-1"></i>
                    {{ booking.agencyDetails?.location || 'N/A' }}
                  </div>
                  <div>
                    <i class="fas fa-users me-1"></i>
                    {{ booking.agencyDetails?.capacity || 'N/A' }} passengers
                  </div>
                </div>
              </div>

              <!-- Dates with time remaining -->
              <div class="mb-3">
                <div class="row text-sm">
                  <div class="col-6">
                    <div class="text-muted">Start Date</div>
                    <div class="fw-bold">{{ formatDate(booking.startDate) }}</div>
                  </div>
                  <div class="col-6">
                    <div class="text-muted">End Date</div>
                    <div class="fw-bold">{{ formatDate(booking.endDate) }}</div>
                  </div>
                </div>
                <div class="mt-2" *ngIf="getBookingPriority(booking) === 'high'">
                  <small class="text-danger fw-bold">
                    <i class="fas fa-clock me-1"></i>
                    Starts within 24 hours!
                  </small>
                </div>
              </div>

              <!-- Price -->
              <div class="mb-3">
                <div class="text-center">
                  <span class="h5 text-success fw-bold">
                    {{ formatCurrency(booking.totalPrice || 0) }}
                  </span>
                </div>
              </div>

              <!-- Actions -->
              <div class="d-grid gap-2">
                <div class="btn-group" role="group">
                  <button 
                    class="btn btn-success" 
                    [disabled]="isProcessing(booking.id)"
                    (click)="confirmBooking(booking.id)">
                    <i class="fas fa-check me-1" 
                       [class.fa-spin]="isProcessing(booking.id)"></i>
                    {{ isProcessing(booking.id) ? 'Processing...' : 'Confirm' }}
                  </button>
                  <button 
                    class="btn btn-outline-danger" 
                    [disabled]="isProcessing(booking.id)"
                    (click)="cancelBooking(booking.id)">
                    <i class="fas fa-times me-1"></i>
                    Cancel
                  </button>
                </div>
                <button 
                  class="btn btn-outline-info btn-sm" 
                  [routerLink]="['/booking', booking.id]">
                  <i class="fas fa-eye me-1"></i>
                  View Details
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.border-left-primary { border-left: 0.25rem solid #4e73df !important; }
.border-left-success { border-left: 0.25rem solid #1cc88a !important; }
.border-left-warning { border-left: 0.25rem solid #f6c23e !important; }
.border-left-info { border-left: 0.25rem solid #36b9cc !important; }
.border-left-danger { border-left: 0.25rem solid #e74a3b !important; }

.text-primary { color: #4e73df !important; }
.text-success { color: #1cc88a !important; }
.text-warning { color: #f6c23e !important; }
.text-info { color: #36b9cc !important; }
.text-danger { color: #e74a3b !important; }
.text-gray-300 { color: #dddfeb !important; }
.text-gray-500 { color: #858796 !important; }
.text-gray-600 { color: #6e707e !important; }
.text-gray-800 { color: #5a5c69 !important; }

.card { box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important; }

.card.border-danger { border: 2px solid #e74a3b !important; }
.card.border-warning { border: 2px solid #f6c23e !important; }
.card.border-info { border: 2px solid #36b9cc !important; }

.fa-spin { animation: fa-spin 2s infinite linear; }
@keyframes fa-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(359deg); }
}

/* Pulse animation for urgent bookings */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(231, 74, 59, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(231, 74, 59, 0); }
  100% { box-shadow: 0 0 0 0 rgba(231, 74, 59, 0); }
}

.card.border-danger {
  animation: pulse 2s infinite;
}
</style>
</body>
</html>